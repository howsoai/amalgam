#!/usr/bin/env pwsh
<#
.SYNOPSIS
    Creates the Amalgam version header

.DESCRIPTION
    This script creates the Amalgam version header. It is only needed for legacy
    builds (i.e., legacy VS solutions not generated by CMake) and used as a
    prebuild step. This is not needed when using the CMake build system.

.EXAMPLE
    Create-Amalgam-Version-Header.ps1
#>

# Stop if errors:
$ErrorActionPreference="Stop"

# Run:
function Create-Amalgam-Version-Header {

    [CmdletBinding()]
    param()

    # Read and replace version numbers:
    $HeaderFileIn = "$PSScriptRoot/../cmake/configure_files/AmalgamVersion.h.in"
    $NewHeaderContents = Get-Content($HeaderFileIn)
    $NewHeaderContents = $NewHeaderContents.replace("@AMALGAM_VERSION_MAJOR@","0")
    $NewHeaderContents = $NewHeaderContents.replace("@AMALGAM_VERSION_MINOR@","0")
    $NewHeaderContents = $NewHeaderContents.replace("@AMALGAM_VERSION_PATCH@","0")
    $NewHeaderContents = $NewHeaderContents.replace("@AMALGAM_VERSION_SUFFIX@","")

    # Write new header:
    $HeaderFileOut = "$PSScriptRoot/../../src/Amalgam/AmalgamVersion.h"
    Set-Content -Path $HeaderFileOut -Value $NewHeaderContents

    Write-Host "Done writing new version header: '$HeaderFileOut'"
}

Create-Amalgam-Version-Header

exit 0